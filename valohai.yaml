- step:
    name: create_model
    image: python:3.11
    command:
    - pip install requests valohai-utils
    - python create_model.py

    environment-variables:
    - name: VALOHAI_API_TOKEN
    - name: VALOHAI_URL

    parameters:
    - name: owner
      type: integer
      optional: false
    - name: model_name
      type: string
      optional: false
    - name: model_slug
      type: string
      optional: false
    - name: access_mode
      type: string
      optional: false
      choices:
      - owner_organization
      - teams
    - name: associated_projects
      type: string
      multiple: separate
      optional: false

- step:
    name: create_model_version
    image: python:3.11
    command:
    - pip install valohai-utils
    - python create_model_version.py
    inputs:
    - name: model
      filename: model.h5
      optional: false
    parameters:
    - name: model_url
      type: string
      optional: false
- pipeline:
    reuse-executions: true
    name: create_model_and_version
    nodes:
    - name: create_model
      type: execution
      step: create_model
    - name: create_version
      type: execution
      step: create_model_version
    edges:
    - [ create_model.metadata.model_url, create_version.parameters.model_url ]
